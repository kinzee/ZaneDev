---
title: "弹珠技术总结(一)：实时的预测瞄准"
date: 2026-01-16T10:42:36+08:00
lastmod: 2026-01-16T10:42:36+08:00
draft: false
tags: [GameDev，Unity]
categories: [GameDev，弹珠技术总结]
summary: "在unity中实现实时的物理预测瞄准"

# PaperMod主题配置

showToc: true
tocOpen: false
ShowReadingTime: true
ShowBreadCrumbs: true
ShowPostNavLinks: true
ShowWordCount: true
ShowRssButtonInSectionTermList: true
UseHugoToc: true

# 封面图片（可选）
cover:
    image: "" # 图片路径/URL
    alt: "" # 替代文本
    caption: "" # 封面下的文字说明
    relative: false # 使用页面捆绑包时设为true
    hidden: true # 仅在当前单页隐藏
---

## 关于弹珠项目

弹珠是自己2025年在职期间开发的一款弹珠台式的肉鸽手游，玩家发射不同的弹珠，碰撞钉子来对敌人造成伤害。

## 运行效果

![弹珠瞄准线效果](/img/image_1768548336611_0.png)

## 技术方案

弹珠的运动完全由物理引擎控制，要保证准确性只能在物理引擎中模拟整个发射流程。因此一开始的方案就是在玩家改变发射角度时，通过实际发射一颗完全一样但是看不到的弹珠来获得运动轨迹。除了简单外，也不会有额外的性能消耗。缺点很明显，太慢了，实际效果就和喷泉里的小男孩一样。

之后还是采用了常规的双物理场景的方案。创建独立的预测物理场景，并且手动控制物理世界的步进。当我们需要刷新瞄准时，可以在1帧内让物理世界跑N个固定步长时间，达到加速效果。保证了我们的实时反馈，同时也不会影响主场景的逻辑。

## 主要实现

``` csharp
Physics2D.simulationMode = SimulationMode2D.Script;
CreateSceneParameters parameters = new CreateSceneParameters(LocalPhysicsMode.Physics2D);
predictionScene = SceneManager.CreateScene("Prediction", parameters);
predictionPhysicsScene = predictionScene.GetPhysicsScene2D();
    
public void UpdatePredict()
{
    // maxIterations 取决于瞄准线的最大长度
 for (int i = 0; i < maxIterations; i++)
 {
    predictionPhysicsScene.Simulate(Time.fixedDeltaTime);
    // 绘制路径曲线
 }
}
```

## 还有哪些问题

- 如何将主场景中的物体实时同步到预测场景内
- 哪些主场景逻辑需要在预测场景中应用。比如撞击销毁

这些问题目前没有被很好的解决，或者说不够完善。当前只是在特殊阶段针对几个固定类型的对象进行拷贝。使用一个绑定组件同步主场景原始对象的坐标和激活状态。

至于第二个问题，游戏中的准线在接触到第一个钉子时就结束了。暂时就不需要考虑了。
